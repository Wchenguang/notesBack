计算机网络笔记
------

# 第一章

* 因特网的边缘：用户主机 因特网的核心：网络以及链接网络的路由器
* 线路交换的线路个数：n * (n - 1) / 2
* 分组交换优点
	* 高效：多个分组共享信道
	* 迅速：不必先建立连接
	* 可靠：分布式，生存性高
* 网络性能指标
	* 速率：数据率b/s
	* 带宽：数字信道所能传送的最高数据率
	* 吞吐量：单位时间内通过某个网络的数据量
	* 时延
		* 发送时延：第一比特到最后比特，数据块长度/信道带宽
		* 传播时延：信道长度/信号在信道上的	
		* 处理时延：存储转发
		* 排队时延：分组排队
	* 时延带宽积：在得到回复之前能往信道发送的最大信道容量：传播时延*带宽
	* 信道利用率：有数据通过的时间的百分比，网络的利用率-信道利用率的加权平均值，不是越高越好
* 时延与网络利用率的关系
	* D-网络当前的时延。D0-网络空闲时的时延，U-网络的利用率-比例：D/D0 = 1/1-U

# 第二章

* 网络协议：为网络数据交换而制定的规则
* 各层要完成的功能：
	* 差错控制：更可靠
	* 流量控制：发送端别太快，接受来不及
	* 分段和重组：发送端将发送的数据划分为更小的单位
	* 复用和分用：
	* 连接的建立和释放
* OSI七层：应用层-表示层-会话层-传输层-网络层-数据链路层-物理层

# 第三章

## 3.1数据通信概念

### 3.1.1
* 二进制代码0，1称为码元

### 3.1.2 数据传输类型
* 同步方式传输信息：需要在每一位后面添加同步信息，所以需要附加一条传输时钟脉冲的线路，可以对数字信号编码以解决
	* 曼彻斯特编码 差分曼彻斯特编码
	* 外同步-真的发脉冲信号 内同步-从数据信号中提取同步信号

* 异步方式
	* 接受与发送时钟脉冲

## 3.3
* 调制：数字-模拟 解调：模拟-数字
* 幅移：简单，抗干扰能力弱
* 频移：简单，抗干扰能力强
* 数字数据的数字信号
	* 数字归零码ZRZ
		* 无法判断一位的开始与结束，收发双方不能保持同步
		* 为保证同步，需要另一信道同时发送同步信号
		* 1与0个数不同，存在直流分量
	* 曼彻斯特编码
		* 每个比特的周期T分为两部分，前T/2发送比特的反码，后T/2发送比特的原码
		* 每个比特中间有一次电平跳变，两次电平跳变时间间隔可以为T或T/2
		* 曼彻斯特编码自含时钟同步信号--中间的表示T/2
	* 差分曼彻斯特编码
		* 中间的跳变只作为周期同步使用
		* 每个比特的值根据其开始边界是否发生跳变来决定-跳变表示0-不跳变表示1
	

## 3.4 基带传输技术
* 比特序列数字信号是矩形脉冲信号，矩形脉冲信号-基带信号
* 矩形脉冲信号的固有频率是基本频带
* 在数字信道上直接传输基带信号称为基带传输
* 发送端将数据编码变换为直接传输的基带信号，如曼和差曼
* 接收端解码
* 信道的极限容量 
	* 带宽受限，噪声，干扰，失真
	* 码元：使用波形表示数字信号，代表不同离散值的基本波形称为码元，1码元可以携带nbit的数据，码元传输速率称为码元速率或传码率，单位为波特
	* 理想信道码元传输速率Rmax Rmax=2 * B(b/s) B：理想通信信道带宽
	* 信噪比S/N：	10 Log10()
	* 香农定理：数据传输速率C与信道带宽B，S/N关系为：C = B * log2(1+S/N) b/s

## 3.6 
* 频分多路复用
	* 在一条通信线路设计多路通信信道
	* 每路信道以不同的频率调制
	* 载波频率不重叠，一个线路可以发送多种信号
* 波分：用波长分割
* 时分复用：
	* 将信道用于传输的时间分为多个时间片
	* 每个用户分的一个时间片
	* 在其占用的时间片内，用户使用通信信道的全部带宽
	* 分为TDM帧：
		* 同步时分：每个帧有所有的时间片，片没人用就空着
		* 统计时分：每个帧的片都用，不一定给固定的主机
* 码分复用：每个站由m个bit的码片序列
	* 发送1则发送自己的m位
	* 发送0则发送自己的补码
	* 特点
		* 每个站的码片序列必须不同，而且正交----即内积等0
		* 每个码片和自己的内积为1
		* 码片与自己的反码内积为-1

# 第四章 数据链路层

* 使用的信道
	* 点对点信道：一对一的点对点通信
	* 广播信道：一对多

## 4.1点对点信道的数据链路层
* 数据链路-网卡，协议
* 数据链路传输的是数据帧
* 封装成帧
	* 在一段数据的前后分别添加首部和尾部，确定界限
	* 首部和尾部：帧定界
* 透明传输
	* 发送端在数据中出现控制字符SOH或EOT，在其前面插入ESC
	* 字节填充：接收端在讲数据发送到网络层之前删除插入的转义字符
	* 如果转义字符出现在数据中，在其前面再插入一个转义字符，连续两个转义字符表示转义字符
* 差错检验
	* 误码率BER：一段时间内传输错误的比特所占比特总数的比例
	* 循环冗余码检验CRC
		* 在发送端将数据分为分组，每组K个比特
		* 在每组k个比特后面添加供差错检测用的n位冗余码
		* 计算冗余码
			* 在k位后面补m个0，km除以预定好的m+1位数，得到的余数FCS，KM+FCS 即要传输的位
			* 接收端接收到数据，做CRC校验，如果余数是0，即是正确的
			* 不能检测到具体出错的位数

## 4.2 PPP协议

* 点对点协议
* 组成
	* 封装IP数据报的方法
	* 链路控制协议LCP
	* 网络控制协议NCP
* 协议字段：
	* 0x0021：IP数据报
	* 0xc021：链路控制协议数据
	* 0x8021：网络控制协议数据
* 透明传输
	* 字符填充：
		* 每出现一个0x7E，就变成 两个字节0x7D，0x5E
		* 若出现0x7D就变成0x7D 0x5D
		* 如出现控制字符加入0x7D，并改变该字符的编码
	* 零比特填充：使用同步传输时使用
		* 在发送端只要检测到5个连续1，则立即填入一个0
		* 接收端扫描数据，发现连续5个1，就把后面的0去掉
* PPP不使用序号和确认的原因
	* 出现差错的概率不大
	* 数据链路层的可靠传输不保证网络层的可靠传输
	* FCS 可以保证无差错接受

* 广播协议
* 局域网的优点
	* 广播功能：可以访问全网
	* 便于系统的扩展
	* 提高了系统的可靠性，可用性，残存性
* 适配器的作用
	* 进行串行/并行的转换
	* 对数据进行缓存
	* 在计算机的操作系统安装驱动
	* 实现以太网协议
* 计算机通过适配器和局域网通信
* CSMA/CD协议
	* 许多主机链接到一根总线上
	* 根据目的主机判断是否应该接受
* 以太网提供的服务
	* 进最大努力的不可靠交付
	* 有差错就丢弃数据帧
* 以太网都使用曼彻斯特编码
* 载波监听多点接入/碰撞检测 CSMA/CD
	* 多个计算机接在一根总线
	* 发送之前，检测是否有信息发送，
* 碰撞检测
	* 边发送数据边检测线路的电压，若大于一定值，则有两个以上主机发送
* 发现碰撞后
	* 总线上碰撞后，数据严重失真，没意义
	* 检测到，就立刻停止发送，等待一段随机的时间再尝试发送
* 由于发送需要时间，可能在到大接受方之前，结束发送，接收方无法检测，而发出，导致碰撞
* 以太网只能双向交替不能双全工，每个站可能遭遇碰撞
* 争用期
	* 发送数据的一方，在发送了数据之后，至少经过2T时间才确定没有发生碰撞，（数据来回的时间）
	* 二进制指数类型退避算法
	* 发送数据的一方在发送数据结束后，等待随机时间R再发送
		* 确定基本退避时间--R = 2 * T
		* 定义重传次数k，k<=10
		* 从[0,(2^k-1)]随机选择r，则退避时间是r * 2T
		* 重传16次仍然不能成功丢弃该帧
	* 争用期的长度：51.2miu秒，可发送64字节，若前64字节没有冲突，则后续的数据就不会冲突
	* 最短有效帧长
		* 若发生冲突，则必在前64字节内，故数据帧最短64字节，小于64字节的为无效帧
	* 帧间最小的间隔为9.6miu秒，96bit的时间，因为主机检测到总线空闲，还要再等待9.6才发送数据，保证接收方缓存来得及清理（不同主机发的帧的间隔！）
* 强化碰撞
	* 检测到碰撞立刻停止发送，在继续发送若干位的人为干扰信号
* 参数a：以太网单程端到端时延T/帧的发送时间T0
	* 极限信道利用率Smax=T0/(T0+T) = 1/(1+a)

## 4.4
* mac地址：48位
* 数据字段-46-1500字节
* 保证mac帧64字节
* 局域网扩展
	* 集线器--物理层
		* 优点
			* 不同碰撞域的主机能跨碰撞域通信
			* 扩大了局域网的地理范围
		* 缺点
			* 碰撞域增大，吞吐量未提高
			* 不同碰撞域数据率不同不能连接
	* 网桥-数据链路层
		* 保存 地址与接口
		* 优点
			* 过滤通信量
			* 扩大物理范围
			* 提高可靠性
			* 可以连接不同物理层
			* 隔离碰撞域
		* 缺点
			* 存储转发增加了时延
			* mac子层没有流量控制
			* 只适用用户数不多的通信量不太大的局域网
	* 透明网桥
		* 自学习，记住发来的地址和端口
		* 没有就转发，有就发，若是入口就丢弃
		* 生成树，避免帧不断转发




# 第五章 网络层

## 5.2 IP
* 路由器，主机全局唯一IP
* 网络号 和 主机号---网络号全1全0不用
* 子网：将一个大的网络分成几个较小的网络，每一个网络有自己的子网地址
* 超网：将几个网络合并成一个更大的网络
* 子网
	* 主机IP与子网掩码与-获得网络地址
* CIDR ：使用网络前缀，无分类
	* CIDR 地址块：
	* 101.2.1.2/20 ---- 相当于20位网络号，12位主机号
	* 聚合

## 5.3 IP协议
* IP数据报最大长度-2^16 - 1
* 数据分片----MF=1后面还有，DF=0可以分片，偏移指原组内偏移，以8字节为单位
* 首部校验和，只校验首部，不校验数据
* 路由表
	* 网络地址
* 路由器接到待转发数据报，不改变数据报的IP，而是在下层将IP通过ARP转化为mac
* 路由：本网络-同ip特定主机路由-同网络路由-默认路由
* 带子网掩码路由-和本网络所有子网掩码与同地址，直接-同IP特定主机路由-路由表每一行子网掩码与，同网络则下一条路由-默认路由
* 主机ARP缓存-macIP-缓存本局域网的
* 路由选择协议
	* 内部网关协议：IGP，rip
		* RIP：
			* 网络中每一个路由器维护自己到每一个其他网络的距离记录
			* 距离=跳数 允许的最短距离为16
			* 实现简单，限制规模
		* OSPF 最短路径优先协议：DJ
			* 链路状态数据库，分区域，主干区域，自治区域，洪泛获取信息，在区域内获取
	* 外部网关协议：BGP
		* 每一个自治系统选择一个路由器作为BGP发言人（常常是边界路由器）
		* 交换路径向量
			* 自治：去a过我
			* 主干：去a过他


# 第六章 传输层
* 应用和传输层通过socket通信
* UDP：不可靠，面向数据，
	* IP上，增加了端口与差错检验
	* 伪首部只是为了计算校验和

* TCP：面向连接
	* TCP根据对给出的窗口值和当前网络的拥塞程度来决定报文段包含多少字节，可以截断，可以积累；
	* TCP 可靠传输
		* 有差错 有丢包
			* 发送方等待一段时间，若果没收到ACK重传
			* 接收方必须在确认报文中包含序号
			* 需要计时器
		* 停止等待
			* 发送方发送一个报文，等待确认
			* 信道利用率低
		* 流水线传输
			* 发送方可以连续发送多个分组，不必每发完一个就等待
				* 增加范围序号
				* 协议的发送方和接收方必须缓存多个分组
				* 流水线差错回复（差错控制）
					* GoBackN
						* 发送方在流水线中最多保持N个未确认的报文
						* 接收方对按序到达的最后一个分组发送确认
						* 发送方维护最早未确认报文段的计时器，如果超时，则重传所有未确认报文
					* 选择重传
						* 发送方在流水线中保持N个未能确认的报文
						* 要求接收方逐个确认接收到的报文
						* 发送方只重传出错的报文
						* 发送方为每一个未确认的报文维护计时器，计时到则重传
		* TCP的可靠传输的实现（差错控制）
			* 每次发送一个报文就设置一次计时器，重传时间到就重传
				* 设置重传时间
					* 过小导致频繁的重传
					* 过大导致延迟
					* 利用RTT（数据报在TCP中的往返时间）
				* 加权平均往返时间RTT
					* 第一次测RTT就设置为RTTs
					* 以后每测到一次RTT，RTTs = (1 - a) x 旧的RTT + a * 侧的RTT
				* 超时重传时间RTO
					* RTO = RTTs + 4 * RTTd
				* karn算法
					* 计算RTT，只要报文段重传，就不采用往返时间样本，每每重传一次，把RTOx2，最大到64s
		* TCP ACK的生成
		
		* TCP 流量控制
			* 发送方缓存：准备发送的数据，TCP已发送还未受到确认的
			* 接受缓存：按序到达还来不及读取的数据，不按序到达的数据
			* 滑动窗口
				* 发送方A根据接受方B的窗口值建立窗口
				* A的窗口可以收缩与扩大，不能后缩
				* 发送方 可用窗口-未能发送的窗口
				* A受到确认向前挪动
				* 若A都没受到确认不能再发送
				* A和B由于时间滞后不一定一样大
				* 接收方必须累计确认
		* TCP 拥塞控制
			* 接受方发送确认，确认号+能接受的字节数
		* 持续计时器
			* TCP为每一个连接设置一个持续计时器
			* 只要受到对方的零窗口通知启动持续计时器
			* 若持续计时器到时间，发送一个零窗口探测报文，对方在这个探测报文端时给出现在的窗口值
			* 若仍然是0，就重新设置持续计数器
			* 若不是0打破僵局
		* TCP传输连接建立与连接释放
			* 连接建立-通过握手
			* 数据传送-窗口控制
			* 连接关闭-发送方相接收方发送关闭链接请求，仍然可以接受数据，只有当接收方发出了关闭链接请求的确认，发送方受到该确认后正式关闭链接
			* 链接建立：
				* 三个问题：
					* 使得每一方确认对方的存在
					* 协商参数
					* 对传输实体资源分配
				* 客户服务器方式
					* 主动发起链接的叫客户，被动等待的是服务器
				* 三次握手
					* 一次：A->SYN = 1，seq=x
					* 二次：B->SYN = 1，ACK = 1，seq=y，ack=x+1 A受到后通知上层应用链接已经建立
					* 三次：A->ACK = 1，seq=x+1,ack=y+1（B受到后通知上层链接已经建立）
			* 连接释放
				* A->FIN = 1,seq = u
				* B->ACK=1，seq=v，ack=u+1（A->B的连接已经释放，但是A还能接受B的数据）
				* 若B没数据可以发送，就通知A释放连接
				* B->FIN = 1，ACK = 1，seq = w， ack = u + 1
				* A->B ACK = 1，seq=u+1，ack = w+1（即使现在A不能发送数据了）
			* TCPA连接必须经过时间2MSL才真正释放掉：为了保证A发送的最后一个ACK报文能到达B，等待网络中所有本次链接产生的报文段消失，防止之后新的连接建立后，受到上次连接的连接请求
		* 拥塞控制
			* 发送方维护两个变量：初始量cwnd=MSS，ssthresh慢开始门线
			* 当cwnd<=ssthresh 执行慢开始算法 每受到一个确认 cwnd+=MSS
			* 当cwnd>ssthresh执行拥塞避免算法：cwnd=cwnd+MSS*MSS/cwnd
			* 当拥塞发生（超时）
				* ssthresh=max(2, min(cwnd, rwnd(流量窗口))/2)
			* 一个传输轮次结束：cwnd中数据报都发送出去，cwnd加倍
		*当网络出现拥塞
			* ssthresh设置为当时cwnd的一半
			* 把拥塞窗口cwnd设置为1
			* 执行慢开始算法
		* 快重传
			* 接受方一受到失序的报文段，就发送上一个报的重复确认，连着一直发，发送方连续受到3个重复确认，立刻发送缺失的文件
		* 快恢复
			* 当发送端受到连续3个重复确认，就慢开始门线减半，然而cwnd不设置1，而是设置为门线值，然后执行拥塞避免（线性增大）
		* rwnd：接收方的窗口
		* cwnd：网络的拥塞窗口

# 第七章
* DNS，主机向本地服务器查询-递归查询-本地服务器查好了给主机
* DNS，本地服务器向根域名服务器查询-迭代查询-一层一层告诉去哪找
* DNS缓存
	* 一个DNS服务器接收一个DNS回答，将回答的信息缓存在本地
	* DNS缓存一段时间后丢弃
* URL：协议：//主机：端口/路径
* HTTP报文：开始行-首部行-实体主体
* 分割CRLF
* 响应报文：开始行：状态行，首部行，实体主体（有些响应报文不用）
* Cookie：首部行有，前后端有文件数据库
* 
